pipeline {
    agent any

    triggers {
        pollSCM '* * * * *'
    }

    stages {
        stage('Build') {
            steps {
                bat 'mvn clean install'
            }
        }
        stage('Tests') {
            steps {
                bat 'mvn test'
            }
        }
        stage('Push Docker image') {
            environment {
                    DOCKER_PATH = 'tobias'
                    DOCKER_AUTH = credentials('DOCKER_HUB_AUTH')

                    DOCKER_IMAGE_NAME = 'spring_docker_test'
            }
            steps {
                bat 'docker login --username=$DOCKER_AUTH --password=$DOCKER_AUTH_PSW'
                bat 'docker push $DOCKER_PATH/$DOCKER_IMAGE_NAME'
            }
        }
    }
}
